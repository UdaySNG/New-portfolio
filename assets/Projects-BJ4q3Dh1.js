import{r as s,p as E,j as e,L as H,m as A,g as _,A as q,P as D}from"./index-BaO_y-Zj.js";const T="http://localhost:8000/api",M=5e3,F=15e3,O=()=>{const[u,g]=s.useState([]),[w,k]=s.useState(!0),[h,x]=s.useState(!1),[j,f]=s.useState(null),i=s.useRef(!1),o=s.useRef(null),m=s.useRef(!1),p=async()=>{if(m.current)return;m.current=!0;const l=new AbortController,n=setTimeout(()=>{console.log("Fetch timeout reached, aborting request..."),l.abort()},M);try{console.log("Attempting to fetch from API...");const r=await fetch(`${T}/projects`,{signal:l.signal,headers:{Accept:"application/json","Content-Type":"application/json"}});if(clearTimeout(n),!r.ok)throw new Error(`Failed to fetch projects: ${r.status} ${r.statusText}`);const d=await r.json();console.log("Successfully fetched data from API:",d);const b=Array.isArray(d)?d:d.data||[];if(!b||b.length===0)throw new Error("No projects data received");g(b),x(!1),f(null),k(!1),i.current=!0}catch(r){clearTimeout(n),r.name==="AbortError"?(console.warn("Request was aborted due to timeout"),f("Request timed out. Using fallback data.")):(console.warn("API fetch failed:",r.message),f(r.message||"Failed to fetch projects. Using fallback data.")),g(E.data),x(!0),k(!1)}finally{m.current=!1}},c=s.useCallback(async()=>{if(!(document.hidden||m.current))try{if(!(await fetch(`${T}/health`,{headers:{Accept:"application/json","Content-Type":"application/json"}})).ok)throw new Error("Backend health check failed");h&&(console.log("Backend is healthy, fetching real data..."),p())}catch{h||(console.log("Backend is down, switching to fallback data..."),g(E.data),x(!0),f("Backend is unavailable. Using fallback data."))}},[h]);return s.useEffect(()=>{p(),i.current&&(o.current=setInterval(c,F));const l=()=>{document.hidden?o.current&&(clearInterval(o.current),o.current=null):i.current&&(o.current=setInterval(c,F))};return document.addEventListener("visibilitychange",l),()=>{o.current&&clearInterval(o.current),document.removeEventListener("visibilitychange",l)}},[c]),{projects:u,loading:w,isUsingFallback:h,error:j}},I="http://localhost:8000/api",V=5e3,L=15e3,K=()=>{const[u,g]=s.useState([]),[w,k]=s.useState(!0),[h,x]=s.useState(!1),[j,f]=s.useState(null),i=s.useRef(!1),o=s.useRef(null),m=async()=>{const c=new AbortController,l=setTimeout(()=>{console.log("Fetch timeout reached, aborting request..."),c.abort()},V);try{console.log("Attempting to fetch from API...");const n=await fetch(`${I}/categories`,{signal:c.signal,headers:{Accept:"application/json","Content-Type":"application/json"}});if(clearTimeout(l),!n.ok)throw new Error(`Failed to fetch categories: ${n.status} ${n.statusText}`);const r=await n.json();console.log("Successfully fetched data from API:",r);const d=Array.isArray(r)?r:r.data||[];if(!d||d.length===0)throw new Error("No categories data received");g(d),x(!1),f(null),k(!1),i.current=!0}catch(n){clearTimeout(l),n.name==="AbortError"?(console.warn("Request was aborted due to timeout"),f("Request timed out. Using fallback data.")):(console.warn("API fetch failed:",n.message),f(n.message||"Failed to fetch categories. Using fallback data."));const r=[...new Set(E.data.map(d=>d.category))].filter(Boolean).map((d,b)=>({id:b+1,name:d}));g(r),x(!0),k(!1)}},p=s.useCallback(async()=>{if(!document.hidden)try{if(!(await fetch(`${I}/health`,{headers:{Accept:"application/json","Content-Type":"application/json"}})).ok)throw new Error("Backend health check failed");h&&(console.log("Backend is healthy, fetching real data..."),m())}catch{if(!h){console.log("Backend is down, switching to fallback data...");const l=[...new Set(E.data.map(n=>n.category))].filter(Boolean).map((n,r)=>({id:r+1,name:n}));g(l),x(!0),f("Backend is unavailable. Using fallback data.")}}},[h]);return s.useEffect(()=>{m(),i.current&&(o.current=setInterval(p,L));const c=()=>{document.hidden?o.current&&(clearInterval(o.current),o.current=null):i.current&&(o.current=setInterval(p,L))};return document.addEventListener("visibilitychange",c),()=>{o.current&&clearInterval(o.current),document.removeEventListener("visibilitychange",c)}},[p]),{categories:u,loading:w,isUsingFallback:h,error:j}},z=()=>{const{projects:u,loading:g,isUsingFallback:w,error:k}=O(),{categories:h,loading:x,isUsingFallback:j,error:f}=K(),[i,o]=s.useState("all"),[m,p]=s.useState(!1),[c,l]=s.useState(""),[n,r]=s.useState([]),d=g||x,b=k||f,R=w||j,U=[...new Set((u==null?void 0:u.flatMap(t=>{var a;return((a=t.tags)==null?void 0:a.map(y=>y.name))||[]}))||[])],N=u==null?void 0:u.filter(t=>{const a=i==="all"||t.category&&t.category.toLowerCase()===i.toLowerCase(),y=t.title.toLowerCase().includes(c.toLowerCase())||t.description.toLowerCase().includes(c.toLowerCase()),C=n.length===0||(t.tags||[]).some(v=>n.includes(v.name));return a&&y&&C}),P=t=>{r(a=>a.includes(t)?a.filter(y=>y!==t):[...a,t])},$=()=>{o("all"),l(""),r([])};return d?e.jsx(H,{text:"Fetching projects..."}):b&&!R?e.jsx("div",{className:"min-h-screen bg-white dark:bg-dark pt-20 text-center text-red-400",children:b}):e.jsx("div",{className:"min-h-screen py-20",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-16",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4 text-primary",children:"My Projects"}),e.jsx("p",{className:"text-secondary max-w-2xl mx-auto",children:"A collection of my work, showcasing my skills and experience in various technologies."})]}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>p(!m),className:"p-3 text-accent hover:text-accent/80 transition-colors",title:"Filter Projects",children:e.jsx(_,{className:"w-6 h-6"})})}),e.jsx(q,{children:m&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden bg-white dark:bg-dark-lighter rounded-lg mb-8",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-secondary",children:"Search"}),e.jsx("input",{type:"text",value:c,onChange:t=>l(t.target.value),placeholder:"Search by title or description...",className:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-dark-lighter text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-secondary",children:"Category"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>o("all"),className:`px-4 py-2 rounded-lg transition-all duration-300 hover:scale-105 ${i==="all"?"text-white":"text-gray-700 dark:text-gray-300"}`,style:{backgroundColor:i==="all"?"#6366f1":"#6366f115",border:"1px solid #6366f130",boxShadow:"0 2px 4px #6366f110"},children:"All"}),h==null?void 0:h.map(t=>e.jsx("button",{onClick:()=>o(t.name),className:`px-4 py-2 rounded-lg transition-all duration-300 hover:scale-105 ${i===t.name?"text-white":"text-gray-700 dark:text-gray-300"}`,style:{backgroundColor:i===t.name?"#6366f1":"#6366f115",border:"1px solid #6366f130",boxShadow:"0 2px 4px #6366f110"},children:t.name},t.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-secondary",children:"Technologies"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(t=>{var y,C;const a=(C=(y=u==null?void 0:u.find(v=>{var S;return(S=v.tags)==null?void 0:S.some(B=>B.name===t)}))==null?void 0:y.tags)==null?void 0:C.find(v=>v.name===t);return e.jsx("button",{onClick:()=>P(t),className:`px-4 py-2 rounded-lg transition-all duration-300 hover:scale-105 ${n.includes(t)?"text-white":"text-gray-700 dark:text-gray-300"}`,style:{backgroundColor:n.includes(t)?(a==null?void 0:a.color)||"#6366f1":`${(a==null?void 0:a.color)||"#6366f1"}15`,border:`1px solid ${(a==null?void 0:a.color)||"#6366f1"}30`,boxShadow:`0 2px 4px ${(a==null?void 0:a.color)||"#6366f1"}10`},children:t},t)})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:$,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Clear All"})})]})})}),N&&N.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:N.map((t,a)=>e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},children:e.jsx(D,{project:t})},t.id))}):e.jsx("div",{className:"text-center text-gray-400",children:"No projects found"})]})})};export{z as default};
